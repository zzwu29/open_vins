<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>OpenVINS: Filter Error Evaluation Methods</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">OpenVINS
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="evaluation.html">System Evaluation</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Filter Error Evaluation Methods </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#eval-ov-collection">Collection</a></li>
<li class="level1"><a href="#eval-ov-transform">Transformation</a></li>
<li class="level1"><a href="#eval-ov-plot">Processing &amp; Plotting</a><ul><li class="level2"><a href="#eval-ov-plot-plot">Script &quot;plot_trajectories&quot;</a></li>
<li class="level2"><a href="#eval-ov-plot-singlerun">Script &quot;error_singlerun&quot;</a></li>
<li class="level2"><a href="#eval-ov-plot-dataset">Script &quot;error_dataset&quot;</a></li>
<li class="level2"><a href="#eval-ov-plot-comparison">Script &quot;error_comparison&quot;</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><dl class="section user"><dt>Installation Warning</dt><dd>If you plan to use the included plotting from the cpp code, you will need to make sure that you have matplotlib and python 2.7 installed. We use the to <a href="https://github.com/lava/matplotlib-cpp">matplotlib-cpp</a> to call this external library and generate the desired figures. Please see <a class="el" href="gs-installing.html#gs-install-oveval">Additional Evaluation Requirements</a> for more details on the exact install.</dd></dl>
<h1><a class="anchor" id="eval-ov-collection"></a>
Collection</h1>
<p>The first step in any evaluation is to first collect the estimated trajectory of the proposed systems. Since we are interested in robotic application of our estimators we want to record the estimate at the current timestep (as compared to a "smoothed" output or one that includes loop-closures from future timesteps). Within the ROS framework, this means that we just need to publish the current estimate at the current timestep. We recommend using the following <a class="el" href="classov__eval_1_1Recorder.html">ov_eval::Recorder</a> utility for recording the estimator output directly into a text file. Works with topics of type <code>PoseWithCovarianceStamped</code>, <code>PoseStamped</code>, <code>TransformStamped</code>, and <code>Odometry</code>.</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">node</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;recorder_estimate&quot;</span> <span class="keyword">pkg</span>=<span class="stringliteral">&quot;ov_eval&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;pose_to_file&quot;</span> <span class="keyword">output</span>=<span class="stringliteral">&quot;screen&quot;</span>&gt;</div><div class="line">    &lt;<span class="keywordtype">param</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;topic&quot;</span>      <span class="keyword">type</span>=<span class="stringliteral">&quot;str&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;/ov_msckf/poseimu&quot;</span> /&gt;</div><div class="line">    &lt;<span class="keywordtype">param</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;topic_type&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;str&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;PoseWithCovarianceStamped&quot;</span> /&gt;</div><div class="line">    &lt;<span class="keywordtype">param</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;output&quot;</span>     <span class="keyword">type</span>=<span class="stringliteral">&quot;str&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;/home/user/data/traj_log.txt&quot;</span> /&gt;</div><div class="line">&lt;/<span class="keywordtype">node</span>&gt;</div></div><!-- fragment --><h1><a class="anchor" id="eval-ov-transform"></a>
Transformation</h1>
<p>We now need to ensure both our estimated trajectory and groundtruth are in the correct formats for us to read in. We need things to be in the RPE text file format (i.e. time(s), px, py, pz, qx, qy, qz, qw). We have a nice helper script that will transform ASL / EuRoC groundtruth files to the correct format. By default the EuRoC groundtruth has the timestamp in nanoseconds and the quaternion is in an incorrect order (i.e. time(ns), px, py, pz, qw, qx, qy, qz). A user can either process all CSV files in a given folder, or just a specific one.</p>
<div class="fragment"><div class="line">rosrun ov_eval format_convert folder/path/</div><div class="line">rosrun ov_eval format_convert file.csv</div></div><!-- fragment --><p>In addition we have a specific folder structure that is assumed. We store trajectories by first their algorithm name and then a folder for each dataset this algorithm was run on. The folder names of the datasets need to match the groundtruth trajectory files which should be in their own separate folder. Please see the example recorded datasets for how to structure your folders.</p>
<div class="fragment"><div class="line">truth/</div><div class="line">    dateset_name_1.txt</div><div class="line">    dateset_name_2.txt</div><div class="line">algorithms/</div><div class="line">    open_vins/</div><div class="line">        dataset_name_1/</div><div class="line">            run1.txt</div><div class="line">            run2.txt</div><div class="line">            run3.txt</div><div class="line">        dataset_name_2/</div><div class="line">            run1.txt</div><div class="line">            run2.txt</div><div class="line">            run3.txt</div><div class="line">    okvis_stereo/</div><div class="line">        dataset_name_1/</div><div class="line">            run1.txt</div><div class="line">            run2.txt</div><div class="line">            run3.txt</div><div class="line">        dataset_name_2/</div><div class="line">            run1.txt</div><div class="line">            run2.txt</div><div class="line">            run3.txt</div><div class="line">    vins_mono/</div><div class="line">        dataset_name_1/</div><div class="line">            run1.txt</div><div class="line">            run2.txt</div><div class="line">            run3.txt</div><div class="line">        dataset_name_2/</div><div class="line">            run1.txt</div><div class="line">            run2.txt</div><div class="line">            run3.txt</div></div><!-- fragment --><h1><a class="anchor" id="eval-ov-plot"></a>
Processing &amp; Plotting</h1>
<p>Now that we have our data recorded and in the correct format we can now work on processing and plotting it. In the next few sections we detail how to do this for absolute trajectory error, relative pose error, normalized estimation error squared, and bounded root mean squared error plots. We will first process the data into a set of output text files which a user can then use to plot the results in their program or language of choice. The align mode of all the following commands can be of type <code>posyaw</code>, <code>posyawsingle</code>, <code>se3</code>, <code>se3single</code>, <code>sim3</code>, and <code>none</code>.</p>
<h2><a class="anchor" id="eval-ov-plot-plot"></a>
Script "plot_trajectories"</h2>
<p>To plot the data we can us the following command which will plot a 2d xy and z-time position plots. It will use the filename as the name in the legend, so you can change that to change the legend or edit the code.</p>
<div class="fragment"><div class="line">rosrun ov_eval plot_trajectories &lt;align_mode&gt; &lt;file_gt.txt&gt; ... &lt;file_est9.txt&gt;</div><div class="line">rosrun ov_eval plot_trajectories posyaw 1565371553_estimate.txt truths/V1_01_easy.txt</div></div><!-- fragment --><div class="image">
<img src="plot_xy.png" alt="plot_xy.png" width="70%"/>
</div>
 <div class="image">
<img src="plot_z.png" alt="plot_z.png" width="70%"/>
</div>
<h2><a class="anchor" id="eval-ov-plot-singlerun"></a>
Script "error_singlerun"</h2>
<p>The single run script will plot statistics and also 3 <img class="formulaInl" alt="$\sigma$" src="form_0.png"/> bounds if available. One can use this to see consistency of the estimator or debug how the current run has gone. It also reports to console the average RMSE and RPE values for this run along with the number of samples. To change the RPE distances you will need to edit the code currently.</p>
<div class="fragment"><div class="line">rosrun ov_eval error_singlerun &lt;align_mode&gt; &lt;file_gt.txt&gt; &lt;file_est.txt&gt;</div><div class="line">rosrun ov_eval error_singlerun posyaw 1565371553_estimate.txt truths/V1_01_easy.txt</div></div><!-- fragment --><p>Example output:</p>
<div class="fragment"><div class="line">[ INFO] [1583422165.069376426]: [COMP]: 2813 poses in 1565371553_estimate =&gt; length of 57.36 meters</div><div class="line">[ INFO] [1583422165.091423722]: ======================================</div><div class="line">[ INFO] [1583422165.091438299]: Absolute Trajectory Error</div><div class="line">[ INFO] [1583422165.091445338]: ======================================</div><div class="line">[ INFO] [1583422165.091453099]: rmse_ori = 0.677 | rmse_pos = 0.055</div><div class="line">[ INFO] [1583422165.091459679]: mean_ori = 0.606 | mean_pos = 0.051</div><div class="line">[ INFO] [1583422165.091466321]: min_ori  = 0.044 | min_pos  = 0.001</div><div class="line">[ INFO] [1583422165.091474211]: max_ori  = 1.856 | max_pos  = 0.121</div><div class="line">[ INFO] [1583422165.091481730]: std_ori  = 0.302 | std_pos  = 0.021</div><div class="line">[ INFO] [1583422165.127869924]: ======================================</div><div class="line">[ INFO] [1583422165.127891080]: Relative Pose Error</div><div class="line">[ INFO] [1583422165.127898322]: ======================================</div><div class="line">[ INFO] [1583422165.127908551]: seg 8 - median_ori = 0.566 | median_pos = 0.068 (2484 samples)</div><div class="line">[ INFO] [1583422165.127919603]: seg 16 - median_ori = 0.791 | median_pos = 0.060 (2280 samples)</div><div class="line">[ INFO] [1583422165.127927646]: seg 24 - median_ori = 0.736 | median_pos = 0.070 (2108 samples)</div><div class="line">[ INFO] [1583422165.127934904]: seg 32 - median_ori = 0.715 | median_pos = 0.071 (1943 samples)</div><div class="line">[ INFO] [1583422165.127942178]: seg 40 - median_ori = 0.540 | median_pos = 0.063 (1792 samples)</div></div><!-- fragment --><div class="image">
<img src="singlerun.png" alt="singlerun.png" width="80%"/>
</div>
<h2><a class="anchor" id="eval-ov-plot-dataset"></a>
Script "error_dataset"</h2>
<p>This dataset script will evaluate how a series of algorithms compare on a single dataset. Normally this is used if you just have single dataset you want to compare algorithms on, or compare a bunch variations of your algorithm to a simulated trajectory. In the console it will output the ATE 3D and 2D, along with the 3D RPE and 3D NEES for each method after it performs alignment. To change the RPE distances you will need to edit the code currently.</p>
<div class="fragment"><div class="line">rosrun ov_eval error_dataset &lt;align_mode&gt; &lt;file_gt.txt&gt; &lt;folder_algorithms&gt;</div><div class="line">rosrun ov_eval error_dataset posyaw truths/V1_01_easy.txt algorithms/</div></div><!-- fragment --><p>Example output:</p>
<div class="fragment"><div class="line">[ INFO] [1583422654.333642977]: ======================================</div><div class="line">[ INFO] [1583422654.333915102]: [COMP]: processing mono_ov_slam algorithm</div><div class="line">[ INFO] [1583422654.362655719]: [TRAJ]: q_ESTtoGT = 0.000, 0.000, -0.129, 0.992 | p_ESTinGT = 0.978, 2.185, 0.932 | s = 1.00</div><div class="line">....</div><div class="line">[ INFO] [1583422654.996859432]: [TRAJ]: q_ESTtoGT = 0.000, 0.000, -0.137, 0.991 | p_ESTinGT = 0.928, 2.166, 0.957 | s = 1.00</div><div class="line">[ INFO] [1583422655.041009388]:     ATE: mean_ori = 0.684 | mean_pos = 0.057</div><div class="line">[ INFO] [1583422655.041031730]:     ATE: std_ori  = 0.14938 | std_pos  = 0.01309</div><div class="line">[ INFO] [1583422655.041039552]:     ATE 2D: mean_ori = 0.552 | mean_pos = 0.053</div><div class="line">[ INFO] [1583422655.041046362]:     ATE 2D: std_ori  = 0.17786 | std_pos  = 0.01421</div><div class="line">[ INFO] [1583422655.044187033]:     RPE: seg 7 - mean_ori = 0.543 | mean_pos = 0.065 (25160 samples)</div><div class="line">[ INFO] [1583422655.047047771]:     RPE: seg 14 - mean_ori = 0.593 | mean_pos = 0.060 (23470 samples)</div><div class="line">[ INFO] [1583422655.049672955]:     RPE: seg 21 - mean_ori = 0.664 | mean_pos = 0.081 (22050 samples)</div><div class="line">[ INFO] [1583422655.052090494]:     RPE: seg 28 - mean_ori = 0.732 | mean_pos = 0.083 (20520 samples)</div><div class="line">[ INFO] [1583422655.054294322]:     RPE: seg 35 - mean_ori = 0.793 | mean_pos = 0.090 (18960 samples)</div><div class="line">[ INFO] [1583422655.055676035]:     RMSE: mean_ori = 0.644 | mean_pos = 0.056</div><div class="line">[ INFO] [1583422655.056987984]:     RMSE 2D: mean_ori = 0.516 | mean_pos = 0.052</div><div class="line">[ INFO] [1583422655.058269163]:     NEES: mean_ori = 793.646 | mean_pos = 13.095</div><div class="line">[ INFO] [1583422656.182660653]: ======================================</div><div class="line">[ INFO] [1583422656.183065588]: [COMP]: processing mono_ov_vio algorithm</div><div class="line">[ INFO] [1583422656.209545279]: [TRAJ]: q_ESTtoGT = 0.000, 0.000, -0.148, 0.989 | p_ESTinGT = 0.931, 2.169, 0.971 | s = 1.00</div><div class="line">....</div><div class="line">[ INFO] [1583422656.791523636]: [TRAJ]: q_ESTtoGT = 0.000, 0.000, -0.149, 0.989 | p_ESTinGT = 0.941, 2.163, 0.974 | s = 1.00</div><div class="line">[ INFO] [1583422656.835407991]:     ATE: mean_ori = 0.639 | mean_pos = 0.076</div><div class="line">[ INFO] [1583422656.835433475]:     ATE: std_ori  = 0.05800 | std_pos  = 0.00430</div><div class="line">[ INFO] [1583422656.835446222]:     ATE 2D: mean_ori = 0.514 | mean_pos = 0.070</div><div class="line">[ INFO] [1583422656.835457020]:     ATE 2D: std_ori  = 0.07102 | std_pos  = 0.00492</div><div class="line">[ INFO] [1583422656.838656567]:     RPE: seg 7 - mean_ori = 0.614 | mean_pos = 0.092 (25160 samples)</div><div class="line">[ INFO] [1583422656.841540191]:     RPE: seg 14 - mean_ori = 0.634 | mean_pos = 0.092 (23470 samples)</div><div class="line">[ INFO] [1583422656.844219466]:     RPE: seg 21 - mean_ori = 0.632 | mean_pos = 0.115 (22050 samples)</div><div class="line">[ INFO] [1583422656.846646272]:     RPE: seg 28 - mean_ori = 0.696 | mean_pos = 0.119 (20520 samples)</div><div class="line">[ INFO] [1583422656.848862913]:     RPE: seg 35 - mean_ori = 0.663 | mean_pos = 0.154 (18960 samples)</div><div class="line">[ INFO] [1583422656.850321777]:     RMSE: mean_ori = 0.600 | mean_pos = 0.067</div><div class="line">[ INFO] [1583422656.851673985]:     RMSE 2D: mean_ori = 0.479 | mean_pos = 0.060</div><div class="line">[ INFO] [1583422656.853037942]:     NEES: mean_ori = 625.447 | mean_pos = 10.629</div><div class="line">[ INFO] [1583422658.194763413]: ======================================</div><div class="line">....</div></div><!-- fragment --><div class="image">
<img src="dataset.png" alt="dataset.png" width="100%"/>
</div>
<h2><a class="anchor" id="eval-ov-plot-comparison"></a>
Script "error_comparison"</h2>
<p>This compares all methods to each other on a series of datasets. For example, you run a bunch of methods on all the EurocMav datasets and then want to compare. This will do the RPE over all trajectories, and an ATE for each dataset. It will print the ATE and RPE for each method on each dataset in the console. Then following the <a class="el" href="eval-metrics.html">Filter Evaluation Metrics</a>, these are averaged over all the runs and datasets. Finally at the end it outputs a nice latex table which can be directly used in a paper. To change the RPE distances you will need to edit the code currently.</p>
<div class="fragment"><div class="line">rosrun ov_eval error_comparison &lt;align_mode&gt; &lt;folder_groundtruth&gt; &lt;folder_algorithms&gt;</div><div class="line">rosrun ov_eval error_comparison posyaw truths/ algorithms/</div></div><!-- fragment --><p>Example output:</p>
<div class="fragment"><div class="line">[ INFO] [1583425216.054023187]: [COMP]: 2895 poses in V1_01_easy.txt =&gt; length of 58.35 meters</div><div class="line">[ INFO] [1583425216.092355692]: [COMP]: 16702 poses in V1_02_medium.txt =&gt; length of 75.89 meters</div><div class="line">[ INFO] [1583425216.133532429]: [COMP]: 20932 poses in V1_03_difficult.txt =&gt; length of 78.98 meters</div><div class="line">[ INFO] [1583425216.179616651]: [COMP]: 22401 poses in V2_01_easy.txt =&gt; length of 36.50 meters</div><div class="line">[ INFO] [1583425216.225299463]: [COMP]: 23091 poses in V2_02_medium.txt =&gt; length of 83.23 meters</div><div class="line">[ INFO] [1583425216.225660364]: ======================================</div><div class="line">[ INFO] [1583425223.560550101]: [COMP]: processing mono_ov_vio algorithm</div><div class="line">[ INFO] [1583425223.560632706]: [COMP]: processing mono_ov_vio algorithm =&gt; V1_01_easy dataset</div><div class="line">[ INFO] [1583425224.236769465]: [COMP]: processing mono_ov_vio algorithm =&gt; V1_02_medium dataset</div><div class="line">[ INFO] [1583425224.855489521]: [COMP]: processing mono_ov_vio algorithm =&gt; V1_03_difficult dataset</div><div class="line">[ INFO] [1583425225.659183593]: [COMP]: processing mono_ov_vio algorithm =&gt; V2_01_easy dataset</div><div class="line">[ INFO] [1583425226.442217424]: [COMP]: processing mono_ov_vio algorithm =&gt; V2_02_medium dataset</div><div class="line">[ INFO] [1583425227.366004330]: ======================================</div><div class="line">....</div><div class="line">[ INFO] [1583425261.724448413]: ============================================</div><div class="line">[ INFO] [1583425261.724469372]: ATE LATEX TABLE</div><div class="line">[ INFO] [1583425261.724481841]: ============================================</div><div class="line"> &amp; \textbf{V1\_01\_easy} &amp; \textbf{V1\_02\_medium} &amp; \textbf{V1\_03\_difficult}</div><div class="line"> &amp; \textbf{V2\_01\_easy} &amp; \textbf{V2\_02\_medium} &amp; \textbf{Average} \\\hline</div><div class="line">mono\_ov\_slam &amp; 0.699 / 0.058 &amp; 1.675 / 0.076 &amp; 2.542 / 0.063 &amp; 0.773 / 0.124 &amp; 1.538 / 0.074 &amp; 1.445 / 0.079 \\</div><div class="line">mono\_ov\_vio &amp; 0.642 / 0.076 &amp; 1.766 / 0.096 &amp; 2.391 / 0.344 &amp; 1.164 / 0.121 &amp; 1.248 / 0.106 &amp; 1.442 / 0.148 \\</div><div class="line">....</div><div class="line">[ INFO] [1583425261.724647970]: ============================================</div><div class="line">[ INFO] [1583425261.724655060]: ============================================</div><div class="line">[ INFO] [1583425261.724661046]: RPE LATEX TABLE</div><div class="line">[ INFO] [1583425261.724666910]: ============================================</div><div class="line"> &amp; \textbf{8m} &amp; \textbf{16m} &amp; \textbf{24m} &amp; \textbf{32m} &amp; \textbf{40m} &amp; \textbf{48m} \\\hline</div><div class="line">mono\_ov\_slam &amp; 0.661 / 0.074 &amp; 0.802 / 0.086 &amp; 0.979 / 0.097 &amp; 1.061 / 0.105 &amp; 1.145 / 0.120 &amp; 1.289 / 0.122 \\</div><div class="line">mono\_ov\_vio &amp; 0.826 / 0.094 &amp; 1.039 / 0.106 &amp; 1.215 / 0.111 &amp; 1.283 / 0.132 &amp; 1.342 / 0.151 &amp; 1.425 / 0.184 \\</div><div class="line">....</div><div class="line">[ INFO] [1583425262.514587296]: ============================================</div></div><!-- fragment --><div class="image">
<img src="comparison.png" alt="comparison.png" width="100%"/>
</div>
 </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
